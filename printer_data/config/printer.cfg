#  Octopus Pro boards STM32H723.  Select the appropriate micro-controller in "make
# menuconfig" and select "Enable low-level configuration options". For
#  For STM32H723 boards use a "128KiB bootloader" and a "25Mhz crystal"
# See docs/Config_Reference.md for a description of parameters.
[exclude_object]
[include macros/macro.cfg]
[include config/fan.cfg]
[include config/stepper.cfg]
[include config/led.cfg]
[include mainsail.cfg]
[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT
[respond]   #activate messages
[gcode_arcs]  #activate round corner
resolution: 0.1



[force_move]
enable_force_move: True



[gcode_macro _CLIENT_VARIABLE]
variable_use_custom_pos   : True ; use custom park coordinates for x,y [True/False]
variable_custom_park_x    : 10.0   ; custom x position; value must be within your defined min and max of X
variable_custom_park_y    : 10.0   ; custom y position; value must be within your defined min and max of Y
variable_custom_park_dz   : 25.0   ; custom dz value; the value in mm to lift the nozzle when move to park position
variable_retract          : 0.50   ; the value to retract while PAUSE
variable_cancel_retract   : 0.80   ; the value to retract while CANCEL_PRINT
variable_speed_retract    : 35.0  ; retract speed in mm/s
variable_unretract        : 0.80   ; the value to unretract while RESUME
variable_speed_unretract  : 35.0  ; unretract speed in mm/s
variable_speed_hop        : 15.0  ; z move speed in mm/s
variable_speed_move       : 100.0 ; move speed in mm/s
variable_park_at_cancel   : True ; allow to move the toolhead to park while execute CANCEL_PRINT [True/False]
variable_park_at_cancel_x : 10  ; different park position during CANCEL_PRINT [None/Position as Float]; park_at_cancel must be True
variable_park_at_cancel_y : 10  ; different park position during CANCEL_PRINT [None/Position as Float]; park_at_cancel must be True
## !!! Caution [firmware_retraction] must be defined in the printer.cfg if you set use_fw_retract: True !!!
variable_use_fw_retract   : True ; use fw_retraction instead of the manual version [True/False]
variable_idle_timeout     : 0     ; time in sec until idle_timeout kicks in. Value 0 means that no value will be set or restored
variable_runout_sensor    : "filament_switch_sensor fs_extruder"    ; If a sensor is defined, it will be used to cancel the execution of RESUME in case no filament is detected.
##                                   Specify the config name of the runout sensor e.g "filament_switch_sensor runout". Hint use the same as in your printer.cfg
## !!! Custom macros, please use with care and review the section of the corresponding macro.
## These macros are for simple operations like setting a status LED. Please make sure your macro does not interfere with the basic macro functions.
## Only  single line commands are supported, please create a macro if you need more than one command.
#variable_user_pause_macro : ""    ; Everything insight the "" will be executed after the klipper base pause (PAUSE_BASE) function
#variable_user_resume_macro: ""    ; Everything insight the "" will be executed before the klipper base resume (RESUME_BASE) function
#variable_user_cancel_macro: ""    ; Everything insight the "" will be executed before the klipper base cancel (CANCEL_PRINT_BASE) function
gcode:

########################
########################
### Printer
########################

[printer]
kinematics: corexy
max_velocity: 600
max_accel: 60000
minimum_cruise_ratio: 0.7
max_z_velocity: 30
max_z_accel: 1500
square_corner_velocity: 7

[input_shaper]
shaper_freq_x: 132.6
shaper_type_x: ei
damping_ratio_x: 0.043
shaper_freq_y: 92.0
shaper_type_y: ei
damping_ratio_y: 0.041

[mcu host]
serial: /tmp/klipper_host_mcu

[mcu]
canbus_uuid: 59469bda118c

[mcu EBBCan]
canbus_uuid: 7923f36815fd

[temperature_sensor Octopus]
sensor_type: temperature_mcu
max_temp: 100

[temperature_sensor raspberry_pi_4B]
sensor_type: temperature_host
min_temp: 10
max_temp: 100 



########################
########################
### Extruder
########################
[extruder]
step_pin: EBBCan: PD0
dir_pin: !EBBCan: PD1
enable_pin: !EBBCan: PD2
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 22 
Gear_ratio: 50:10
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: EBBCan: PB13
control: pid
pid_Kp: 23.216 
pid_Ki: 1.629 
pid_Kd: 82.712
min_temp: 0
max_temp: 450

sensor_type:MAX31865
sensor_pin: EBBCan: PA4
spi_bus: spi1
rtd_nominal_r: 1000
rtd_reference_r: 4300
rtd_num_of_wires: 2

max_extrude_only_distance: 250.0
max_extrude_cross_section: 250
#pressure_advance: 0.02
#pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: EBBCan: PA15
run_current: 0.85
stealthchop_threshold: 0


########################
########################
### Heatbed
########################

[heater_bed]
heater_pin: PF5
sensor_pin: PB1 # TB
sensor_type: ATC Semitec 104GT-2
min_temp: 0
max_temp: 130
control: pid
pid_kp: 54.122
pid_ki: 2.864
pid_kd: 255.727
max_power: 0.7

########################
########################
### Cartographer
########################

[scanner]
canbus_uuid: 7dd159b0a935       
x_offset: 0
y_offset: 23    
#scanner_touch_threshold: 800 #800ht Ideal 
calibration_method: touch
sensor: cartographer
sensor_alt: carto
speed: 2.
lift_speed: 5.0
backlash_comp: 0.00915
cal_nozzle_z: 0.1
cal_floor: 0.1
cal_ceil:5.
cal_speed: 1.0
cal_move_speed: 10.
default_model_name: default
mesh_main_direction: x
mesh_cluster_size: 1
mesh_runs: 2
samples_result: median
scanner_touch_accel: 100
scanner_touch_max_speed: 10
scanner_touch_speed: 2
scanner_touch_retract_dist: 2
scanner_touch_retract_speed: 10
scanner_touch_sample_count: 10
#scanner_touch_tolerance: 0.1
scanner_touch_max_retries: 5
scanner_touch_move_speed: 50
#scanner_touch_z_offset: 0.05 # instead of having it in your print start - touch only
########################
########################
### Bed Mesh
########################

[bed_mesh]
speed: 400
horizontal_move_z: 5

mesh_min: 12, 23
mesh_max: 207, 195
mesh_pps: 0,0
move_check_distance: 3
probe_count: 30,30
algorithm: bicubic
zero_reference_position: 115,115

[safe_z_home]
home_xy_position: 110, 91.5
speed: 100.0
z_hop: 5
z_hop_speed: 5

[screws_tilt_adjust]
screw1: 27, 0
screw1_name: vorne links
screw2: 27, 175
screw2_name: hinten links
screw3: 196, 175
screw3_name: hinten rechts
screw4: 196, 0
screw4_name: vorne rechts
speed: 200
horizontal_move_z: 5
screw_thread: CW-M4
#   The type of screw used for bed leveling, M3, M4, or M5, and the
#   rotation direction of the knob that is used to level the bed.
#   Accepted values: CW-M3, CCW-M3, CW-M4, CCW-M4, CW-M5, CCW-M5.
#   Default value is CW-M3 which most printers use. A clockwise
#   rotation of the knob decreases the gap between the nozzle and the
#   bed. Conversely, a counter-clockwise rotation increases the gap.


[axis_twist_compensation]
speed: 100
calibrate_start_x: 25
calibrate_end_x: 202
calibrate_y: 95

#[neopixel my_neopixel_1]
#pin: PE10

#[neopixel my_neopixel_2]
#pin: PE9

########################
########################
### Motor Sync
########################
[motors_sync]
axes: x,y
#    Axes on which calibration will be performed.
accel_chip: adxl345
#    Accelerometers for vibration collection: adxl345 / mpu9250 / lis2dw,
#    etc. Are indicated general or for axis on which calibration is
#    performed, for example - accel_chip_x or accel_chip_y.
microsteps: 16
#    Maximum microstepping displacement of the stepper motor rotor. It's
#    not necessary to increase the value above 16 with 20t pulley, these
#    fluctuations are elusive.
#model: linear
#    Model of the dependence of the displacement of microsteps on the
#    shaft of a stepper motor depends on the magnitude of the measured
#    oscillations. Are indicated general or for axis. Supported models:
#    linear, quadratic, power, root, hyperbolic, exponential.
#model_coeffs: 20000, 0
#    Coefficients above the described model, for calculating microsteps.
#    Are indicated general or for axis.
#max_step_size: 5
#    The maximum number of microsteps that the motor can take move at time,
#    to achieve the planned magnitude.
#retry_tolerance: 0
#    The forced threshold to which a pair of stepper motors on one belt
#    will have to lower the magnitude of the oscillations. It's recommended
#    to configure in order to filter possible inaccuracies. After several
#    iterations of starting synchronization, you will find the edge, to
#    which this parameter should be omitted.
#retries: 0
#    Maximum number of repetitions to achieve a forced threshold of motor
#    synchronization deviations.

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [scanner model default]
#*# model_coef = 1.4443619131180432,
#*# 	1.8815189806437829,
#*# 	0.7421286410174636,
#*# 	0.2647824333536332,
#*# 	0.36261908870050064,
#*# 	0.5626778011777073,
#*# 	-0.21137940794815363,
#*# 	-0.5796875123216536,
#*# 	0.212071881343796,
#*# 	0.32347060505783903
#*# model_domain = 3.1983435806244296e-07,3.2990184826694634e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 51.059248
#*# model_offset = 0.00000
#*#
#*# [scanner]
#*# scanner_touch_threshold = 1250
#*# scanner_touch_z_offset = -0.030
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.046011, -0.060971, -0.050236, -0.042018, -0.030091, -0.035360, -0.039484, -0.041200, -0.024390, -0.018190, -0.009830, -0.007688, -0.012526, -0.012916, -0.017240, -0.020790, -0.027291, -0.029255, -0.025686, -0.023567, -0.025662, -0.026587, -0.023276, -0.024154, -0.015019, -0.013040, -0.011915, 0.014124, 0.031582, 0.053344
#*# 	  -0.054517, -0.060756, -0.059428, -0.052182, -0.038385, -0.038897, -0.034009, -0.029863, -0.026430, -0.019916, -0.010926, -0.000412, -0.005992, -0.011650, -0.016194, -0.026255, -0.020967, -0.024864, -0.028045, -0.025292, -0.030195, -0.017439, -0.014608, -0.020834, -0.014726, -0.016769, -0.007866, 0.007921, 0.024798, 0.045961
#*# 	  -0.041554, -0.044476, -0.038585, -0.037532, -0.031351, -0.029853, -0.025878, -0.030940, -0.022665, -0.016824, -0.004115, 0.004411, -0.004301, -0.007409, -0.012098, -0.017328, -0.018200, -0.028141, -0.024517, -0.021557, -0.018489, -0.012868, -0.019081, -0.014438, -0.008316, -0.004791, -0.003168, 0.010848, 0.029169, 0.051388
#*# 	  -0.034482, -0.040733, -0.031442, -0.024115, -0.025669, -0.019269, -0.026366, -0.028429, -0.021151, -0.013909, 0.000818, 0.003172, -0.003177, -0.005264, -0.010295, -0.009192, -0.020212, -0.025022, -0.022374, -0.019288, -0.009913, -0.013392, -0.012922, -0.020936, -0.008490, 0.001414, 0.003561, 0.027050, 0.041409, 0.062350
#*# 	  -0.035330, -0.035881, -0.024257, -0.012566, -0.023673, -0.022083, -0.024622, -0.021272, -0.011919, -0.014209, 0.004977, 0.006416, 0.002010, -0.000116, -0.004972, -0.012849, -0.016593, -0.020243, -0.017225, -0.019965, -0.015118, -0.009578, -0.005507, -0.007520, -0.009050, -0.006379, 0.006461, 0.031216, 0.043988, 0.062847
#*# 	  -0.034576, -0.035863, -0.022256, -0.014133, -0.012577, -0.012761, -0.023654, -0.022808, -0.013578, -0.002819, 0.008023, 0.006064, 0.003349, 0.000186, 0.003211, -0.007222, -0.018509, -0.018699, -0.018183, -0.011052, -0.010753, -0.013073, -0.006513, -0.009990, -0.000204, -0.002674, 0.003891, 0.027456, 0.048266, 0.071766
#*# 	  -0.030180, -0.028901, -0.017975, -0.005732, -0.011893, -0.013602, -0.015647, -0.018513, -0.008139, -0.002778, 0.011012, 0.012627, 0.007904, 0.005311, 0.003267, -0.002820, -0.010388, -0.015706, -0.014051, -0.011513, -0.008574, -0.002029, -0.003877, -0.009053, -0.004529, -0.003672, 0.011056, 0.022392, 0.042096, 0.062309
#*# 	  -0.029286, -0.026265, -0.017969, -0.010758, -0.009547, -0.011610, -0.006561, -0.011629, -0.007837, 0.000279, 0.012371, 0.018800, 0.010844, 0.006193, 0.006956, -0.000054, -0.003900, -0.011895, -0.012889, -0.008570, -0.001908, 0.002217, -0.001298, -0.012371, -0.005066, 0.001588, 0.007693, 0.025163, 0.046111, 0.061865
#*# 	  -0.024089, -0.022684, -0.015267, -0.006980, -0.013257, -0.008361, -0.008287, -0.009689, -0.006590, 0.004489, 0.019203, 0.021829, 0.013936, 0.013053, 0.009232, 0.002000, -0.005227, -0.007983, -0.005790, -0.003788, -0.004178, -0.002334, -0.001224, -0.005349, -0.004456, -0.004845, 0.005529, 0.025928, 0.040233, 0.059354
#*# 	  -0.023655, -0.021854, -0.014876, -0.006852, -0.008118, -0.010117, -0.002138, -0.008891, -0.003008, 0.004428, 0.016837, 0.022601, 0.015117, 0.013791, 0.003998, 0.006478, -0.003223, -0.008903, -0.012920, -0.002534, -0.002120, -0.002599, -0.009325, -0.015128, -0.002372, -0.006833, -0.000792, 0.017701, 0.036999, 0.058350
#*# 	  -0.020902, -0.021236, -0.012991, -0.003680, -0.006899, -0.009188, -0.006933, -0.007220, -0.003129, 0.006038, 0.018791, 0.023429, 0.015358, 0.012925, 0.008928, 0.004483, -0.002397, -0.009667, -0.011652, -0.007578, -0.008667, -0.005061, -0.006564, -0.011429, -0.010041, -0.011575, -0.004295, 0.009517, 0.026687, 0.042761
#*# 	  -0.022488, -0.019557, -0.014630, -0.004702, -0.006763, -0.011123, -0.007263, -0.008768, -0.003454, 0.007066, 0.020244, 0.021180, 0.013246, 0.009605, 0.011021, 0.002039, -0.006826, -0.013551, -0.014159, -0.008282, -0.015382, -0.009046, -0.010130, -0.012820, -0.018220, -0.020087, -0.009475, 0.006563, 0.022633, 0.027894
#*# 	  -0.020274, -0.019341, -0.012518, -0.003995, -0.010182, -0.010186, -0.010669, -0.007060, -0.005006, 0.006043, 0.018748, 0.020588, 0.012194, 0.007401, 0.007449, 0.001645, -0.005599, -0.015700, -0.017258, -0.015033, -0.017052, -0.015728, -0.016342, -0.023455, -0.024720, -0.022308, -0.019345, -0.004561, 0.008191, 0.021203
#*# 	  -0.019915, -0.020631, -0.011711, -0.006645, -0.006579, -0.009837, -0.010815, -0.008545, -0.003289, 0.006611, 0.018024, 0.017932, 0.010331, 0.006637, 0.010567, 0.000599, -0.011149, -0.022024, -0.018013, -0.017043, -0.022552, -0.025175, -0.022746, -0.027861, -0.025958, -0.034384, -0.026691, -0.013008, 0.003070, 0.011695
#*# 	  -0.017180, -0.019178, -0.008813, -0.003777, -0.007712, -0.008993, -0.009283, -0.005631, -0.003906, 0.004697, 0.016741, 0.018950, 0.012912, 0.010144, 0.007641, -0.000865, -0.008614, -0.017460, -0.021520, -0.021318, -0.024339, -0.024839, -0.025208, -0.032584, -0.032451, -0.034119, -0.030590, -0.019320, -0.008551, 0.004075
#*# 	  -0.014869, -0.014675, -0.008354, -0.000508, -0.004050, -0.006535, -0.006386, -0.005369, -0.000719, 0.005306, 0.017676, 0.021264, 0.014580, 0.010320, 0.008371, 0.000900, -0.008253, -0.018076, -0.020816, -0.021527, -0.025293, -0.029788, -0.029589, -0.034041, -0.034730, -0.035536, -0.037702, -0.025096, -0.011290, 0.001209
#*# 	  -0.013036, -0.012699, -0.008661, -0.000085, -0.001567, -0.003926, -0.004161, -0.005327, 0.001330, 0.005949, 0.020005, 0.023154, 0.017020, 0.013004, 0.007583, 0.000998, -0.007493, -0.016925, -0.020537, -0.021520, -0.027853, -0.027370, -0.027577, -0.034953, -0.036461, -0.039492, -0.037682, -0.027501, -0.015526, -0.005388
#*# 	  -0.012353, -0.012853, -0.006392, 0.001864, -0.000077, -0.004835, -0.002750, -0.006876, 0.005446, 0.007671, 0.023096, 0.024916, 0.018114, 0.012684, 0.007965, 0.000228, -0.009290, -0.016516, -0.021712, -0.023456, -0.028889, -0.028667, -0.031493, -0.036826, -0.041402, -0.044334, -0.042642, -0.032503, -0.017231, -0.011527
#*# 	  -0.009891, -0.012834, -0.005767, 0.005779, 0.002487, -0.001781, -0.000131, -0.005192, 0.012115, 0.009229, 0.028974, 0.027289, 0.020502, 0.012926, 0.007688, 0.002124, -0.009397, -0.015685, -0.021272, -0.021394, -0.027764, -0.030072, -0.031372, -0.037980, -0.044518, -0.044958, -0.044728, -0.032842, -0.021711, -0.014322
#*# 	  -0.007172, -0.007766, -0.000049, 0.007120, 0.003147, -0.000230, 0.001743, -0.000873, 0.015938, 0.013671, 0.032320, 0.030151, 0.022063, 0.014460, 0.006151, 0.001188, -0.007870, -0.015013, -0.020630, -0.023614, -0.025637, -0.026938, -0.031367, -0.039524, -0.046289, -0.041940, -0.045786, -0.032062, -0.023527, -0.017666
#*# 	  -0.005399, -0.007125, 0.003384, 0.011249, 0.008446, 0.007018, 0.005345, 0.006407, 0.018770, 0.018793, 0.033573, 0.034246, 0.024778, 0.017619, 0.011696, 0.002795, -0.007428, -0.012826, -0.018204, -0.019428, -0.024807, -0.027483, -0.029597, -0.036162, -0.043653, -0.036830, -0.045294, -0.026212, -0.028786, -0.017271
#*# 	  -0.001579, -0.003295, 0.008657, 0.012341, 0.012580, 0.011010, 0.010494, 0.010892, 0.020139, 0.022651, 0.034004, 0.036236, 0.025635, 0.018367, 0.014998, 0.001777, -0.007231, -0.012139, -0.017191, -0.018902, -0.026038, -0.029018, -0.028403, -0.035528, -0.042370, -0.038455, -0.045879, -0.028607, -0.031340, -0.029066
#*# 	  0.001136, -0.002361, 0.015030, 0.014132, 0.017273, 0.016785, 0.014079, 0.016872, 0.022807, 0.028217, 0.034518, 0.038653, 0.028221, 0.022082, 0.017069, 0.003578, -0.005523, -0.011851, -0.016712, -0.021503, -0.026844, -0.028438, -0.027863, -0.037698, -0.038915, -0.040841, -0.046078, -0.033457, -0.033315, -0.027401
#*# 	  0.003305, 0.002343, 0.018884, 0.017470, 0.019542, 0.018822, 0.012951, 0.022125, 0.022617, 0.033019, 0.035987, 0.041103, 0.031780, 0.022228, 0.016093, 0.005329, -0.003832, -0.011606, -0.014778, -0.019098, -0.026095, -0.029023, -0.028060, -0.038096, -0.035847, -0.046946, -0.046329, -0.039927, -0.032687, -0.035721
#*# 	  0.000935, 0.002467, 0.015324, 0.020344, 0.018560, 0.022216, 0.012205, 0.022526, 0.023245, 0.034299, 0.036568, 0.042475, 0.032001, 0.025678, 0.016557, 0.006753, -0.001844, -0.011531, -0.014529, -0.020655, -0.025854, -0.027461, -0.029588, -0.042144, -0.038251, -0.047625, -0.045414, -0.044041, -0.035142, -0.033963
#*# 	  0.001038, 0.006107, 0.014162, 0.025853, 0.021188, 0.023053, 0.014088, 0.021525, 0.022275, 0.034212, 0.037785, 0.041500, 0.032072, 0.024290, 0.019448, 0.007425, -0.000203, -0.010447, -0.016111, -0.021922, -0.026432, -0.027674, -0.031601, -0.043250, -0.044455, -0.051698, -0.049183, -0.048482, -0.039896, -0.039928
#*# 	  0.000861, 0.006097, 0.013250, 0.027537, 0.023463, 0.023227, 0.018603, 0.023145, 0.024703, 0.034740, 0.039668, 0.043490, 0.035994, 0.029377, 0.022824, 0.009828, 0.001129, -0.010581, -0.013951, -0.019281, -0.026129, -0.029017, -0.033411, -0.044000, -0.045496, -0.052494, -0.050471, -0.049396, -0.041985, -0.041047
#*# 	  0.004855, 0.006925, 0.016844, 0.027543, 0.025434, 0.023543, 0.021551, 0.022707, 0.024701, 0.034196, 0.042060, 0.046407, 0.039582, 0.032457, 0.024409, 0.014887, 0.004345, -0.007496, -0.012496, -0.018453, -0.024932, -0.028904, -0.033111, -0.044552, -0.046319, -0.051596, -0.053468, -0.052955, -0.046284, -0.042753
#*# 	  0.006227, 0.001295, 0.013080, 0.018628, 0.026614, 0.026369, 0.024974, 0.024676, 0.025535, 0.033444, 0.043610, 0.047946, 0.044060, 0.033044, 0.023157, 0.009561, 0.000379, -0.007285, -0.010676, -0.016344, -0.025457, -0.028781, -0.035599, -0.043330, -0.047010, -0.054145, -0.057324, -0.055423, -0.052210, -0.045470
#*# 	  0.000915, -0.009903, 0.001769, 0.008688, 0.027432, 0.028330, 0.024938, 0.026508, 0.027547, 0.035498, 0.045182, 0.050411, 0.045745, 0.028849, 0.011790, -0.001833, -0.005456, -0.005115, -0.010694, -0.014618, -0.028617, -0.032633, -0.034657, -0.043984, -0.044673, -0.060204, -0.070542, -0.071923, -0.067172, -0.052127
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 0
#*# mesh_y_pps = 0
#*# algo = direct
#*# tension = 0.2
#*# min_x = 12.0
#*# max_x = 207.0
#*# min_y = 23.0
#*# max_y = 195.0
